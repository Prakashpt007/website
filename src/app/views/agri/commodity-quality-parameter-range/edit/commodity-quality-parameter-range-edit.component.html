<div class="container-fluid p-0">
	<div class="row">
		<div class="col-12 col-sm-12 col-md-12 col-xxl-12 col-xl-12">
			<div class="card">

				<div class="card-header fw-bold bg-body-secondary bg-gradient d-flex justify-content-between">
					<span>Edit Form</span>
					<a [routerLink]="['/agri/quality-parameter-range/list']" [queryParams]="backUrlParams" class="custom-link-btn"><i class="fa-solid fa-list"></i> Back To List</a>
				</div>
				<div class="card-body" style="max-height: calc(100svh - 15.75rem);overflow: auto; padding-bottom: 0;">
					<form [formGroup]="form" (ngSubmit)="formSubmit()" novalidate>
						<div class="row align-items-start">
							<div class="col-12 col-sm-12 col-md-12 col-lg-6 col-xl-4 col-xxl-4 mb-3">
								<div class="form-floating">
									<select class="form-select" id="commodityId" formControlName="commodityId" placeholder="commo" [ngClass]="{'is-invalid': formSubmitHandler && f['commodityId'].errors}">
										<option value="" disabled>Select Commodity</option>
										@for (item of commodityList; track item) {

										<option [value]="item.value">{{item.label}}</option>
										}
									</select>
									<label for="commodityId">Commodity <span style="color:red">*</span></label>
								</div>

								@if(formSubmitHandler && f['commodityId'].errors){

								<div class="invalid-feedback">
									@if(f['commodityId'].errors['required']){
									<div>Please Select Commodity</div>
									}

									@if(form.get('commodityId')?.hasError('backendError')){
									<div>{{ form.get('commodityId')?.getError('backendError') }}</div>
									}
								</div>

								}

							</div>

							<div class="col-12 col-sm-12 col-md-12 col-lg-6 col-xl-4 col-xxl-4 mb-3">
								<div class="form-floating">
									<select class="form-select" id="varietyId" formControlName="varietyId" [ngClass]="{'is-invalid': formSubmitHandler && f['varietyId'].errors}">

										<option value="" disabled>Select Variety</option>
										@for (item of varietyList; track item) {

										<option [value]="item.value">{{item.label}}</option>

										}

									</select>
									<label for="varietyId">Variety <span style="color:red">*</span></label>
								</div>

								@if(formSubmitHandler && f['varietyId'].errors){

								<div class="invalid-feedback">
									@if(f['varietyId'].errors['required']){
									<div>Please Select Variety</div>
									}

									@if(form.get('varietyId')?.hasError('backendError')){
									<div>{{ form.get('varietyId')?.getError('backendError') }}</div>
									}
								</div>

								}

							</div>
						</div>

						@if(this.pageData != undefined){

						@for (param of params; track param) {

						@if(param.options.length > 0){
						<section class="example-section my-4" [ngClass]="{'is-invalid': formSubmitHandler && form.get(param.name)?.invalid}">
							<mat-label>{{param.label}} @if(param.validators.required) {<span>*</span>}</mat-label>


							@if(formSubmitHandler && f[param.name].errors){

							@if(f[param.name].errors?.['required']){

							<mat-error class="m-0">
								{{param.label}} is <strong>required</strong>
							</mat-error>

							}

							}
							@if(formSubmitHandler && form.get(param.name)?.invalid){
							<mat-error>Please Check Atleast One Checkbox</mat-error>
							}

							<app-checkbox-group [componentData]="param" (checkboxUpdate)="onCheckboxUpdate($event)" [valuesData]="param.value" [disabledData]="param.value" (childOptionUpdateByParentId)="getChildDlOptionsByParentId($event)"></app-checkbox-group>


							<div class="text-center m-3">

								<button type="button" (click)="formSubmit()" [ngClass]="{
									'btn-secondary': this.form.get('parameters')?.value.length == 0 || (this.form.get('parameters')?.value.length > 0 && newFormShow),
									'btn-primary': (this.form.get('parameters')?.value.length > 0 && !newFormShow),
									}" [disabled]="(this.form.get('parameters')?.value.length == 0 && !generateFormBtnSts) || newFormShow" class="btn btn-sm">Generate Form</button>

							</div>
						</section>

						}
						}
						}
					</form>


					@if(newFormShow && paramsArr.length > 0){

					<form [formGroup]="newDynamicForm" (ngSubmit)="dynamicFormSubmit()" novalidate>
						<div class="table-responsive-lg mb-3">
							<table class="table rounded-corners m-0">
								<thead>
									<tr style="vertical-align: middle;">
										<th [attr.data-th]="'Params'">Params</th>

										@for (band of pageData.bands; track band) {

										<th [attr.data-th]="band.label">{{ band.label }}</th>

										}
										<th>Action</th>

									</tr>
								</thead>
								<tbody>
									@for (param of paramsArr; track param) {
									<tr formGroupName="{{param.value}}">
										<td class="tableDataTh" style="vertical-align: middle" [attr.data-th]="'Params'">{{ param.label}}</td>

										@for (band of pageData.bands; track band) {

										<td [attr.data-th]="band.label" formGroupName="{{band.value}}">
											<div class="tableFieldFlex">
												<input type="number" step="any" min="000.001" class="form-control form-control-sm" formControlName="min" placeholder="Min" #min [ngClass]="{'is-invalid': dynamicFormSubmitHandler && checking(min.value)}">
												<input type="number" step="any" min="000.001" class="form-control form-control-sm" formControlName="max" placeholder="Max" #max [ngClass]="{'is-invalid': dynamicFormSubmitHandler && checking(max.value)}">
											</div>
										</td>

										}
										<td style="text-align: center;">
											<button type="button" (click)="removeRecord(param.value)" class="btn btn-sm btn-danger" style="line-height: normal;"><i class="fa-solid fa-xmark"></i></button>
										</td>

									</tr>

									}

								</tbody>
							</table>
						</div>
					</form>

					}

				</div>

				@if(newFormShow && paramsArr.length > 0){
				<div class="card-footer d-flex gap-2" style="padding-block:0.875rem;">
					<button type="button" (click)="dynamicFormSubmit()" [disabled]="!newFormShow" class="btn btn-primary btn-sm">Store Data</button>
				</div>
				}
			</div>
		</div>
	</div>
</div>

<ng-template #actionModal let-c="close" let-d="dismiss">
	<div class="modal-header bg-primary text-white bg-gradient py-2">
		<h6 class="modal-title" id="modal-basic-title">Confirmation</h6>
		<button type="button" class="btn-close" aria-label="Close" (click)="d('Cross click')"></button>
	</div>
	<div class="modal-body">
		<p>Are you sure you want to delete this parameters? Please confirm your decision</p>
	</div>
	<div class="modal-footer d-flex justify-content-between">
		<button type="button" class="btn btn-primary bg-gradient" (click)="c('Confirm click')">Confirm.!</button>
		<button type="button" class="btn btn-secondary bg-gradient" (click)="d('Cancel click')">Cancel</button>
	</div>
</ng-template>
